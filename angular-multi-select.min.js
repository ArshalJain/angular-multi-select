!function(a){"use strict";a.module("multi-select",[]).directive("multiSelect",["$q",function(b){function c(b){var c=[];return a.forEach(b,function(a){var b=a;b.selected=!1,c.push(b)}),c}return{restrict:"E",require:"ngModel",scope:{selectedLabel:"@",availableLabel:"@",display:"@",available:"=",model:"=ngModel"},template:'<div class="multiSelect"><div class="select"><label class="control-label" for="multiSelectSelected">{{ selectedLabel }} ({{ model.length }})</label><ul><li ng-repeat="entity in model"><label class="checkbox"><input type="checkbox" ng-model="selected.current[$index].selected"> {{ renderItem(entity) }}</label></li></ul></div><div class="select buttons"><button class="btn mover left" ng-click="add()" title="Add selected" ng-disabled="!selected(selected.available).length"><i class="icon-arrow-left"></i></button><button class="btn mover right" ng-click="remove()" title="Remove selected" ng-disabled="!selected(selected.current).length"><i class="icon-arrow-right"></i></button></div><div class="select"><label class="control-label" for="multiSelectAvailable">{{ availableLabel }} ({{ available.length }})</label><ul><li ng-repeat="entity in available"><label class="checkbox"><input type="checkbox" ng-model="selected.available[$index].selected"> {{ renderItem(entity) }}</label></li></ul></div></div>',link:function(d,e,f){function h(b,c){var e=[];return a.forEach(b,function(a){for(var b=!1,f=0;f<c.length;f++)if(d.renderItem(c[f])==d.renderItem(a)){b=!0;break}b||e.push(a)}),e}d.selected={available:[],current:[]};var g=function(a){var c=b.defer();return d[a]&&!d[a].hasOwnProperty("$promise")?c.resolve(d[a]):d.$watch(a,function(a,b){void 0!==a&&void 0===b&&c.resolve(a)}),c.promise};d.refreshAvailable=function(){d.available=h(d.available,d.model),d.selected.available=c(d.available),d.selected.current=c(d.model)},d.add=function(){d.model=d.model.concat(d.selected(d.selected.available))},d.remove=function(){var a=d.selected(d.selected.current);d.available=d.available.concat(a),d.model=h(d.model,a)},d.selected=function(b){var c=[];return a.forEach(b,function(a){a.selected===!0&&c.push(a)}),c},b.all([g("model"),g("available")]).then(function(){d.refreshAvailable(),d.$watch("model",d.refreshAvailable)}),d.renderItem=function(a){var b=f.display.match(/(.+)\s+as\s+(.+)/);return d[b[1]]=a,d.$eval(b[2])}}}}])}(angular);