(function(e){e.module("multi-select",[]).directive("multiSelect",["$q",function(f){function g(a){var d=[];e.forEach(a,function(a){a.selected=!1;d.push(a)});return d}return{restrict:"E",require:"ngModel",scope:{selectedLabel:"@",availableLabel:"@",display:"@",available:"=",model:"=ngModel"},template:'<div class="multiSelect"><div class="select"><label class="control-label" for="multiSelectSelected">{{ selectedLabel }} ({{ model.length }})</label><ul><li ng-repeat="entity in model"><label class="checkbox"><input type="checkbox" ng-model="selected.current[$index].selected"> {{ renderItem(entity) }}</label></li></ul></div><div class="select buttons"><button class="btn mover left" ng-click="add()" title="Add selected" ng-disabled="!selected(selected.available).length"><i class="icon-arrow-left"></i></button><button class="btn mover right" ng-click="remove()" title="Remove selected" ng-disabled="!selected(selected.current).length"><i class="icon-arrow-right"></i></button></div><div class="select"><label class="control-label" for="multiSelectAvailable">{{ availableLabel }} ({{ available.length }})</label><ul><li ng-repeat="entity in available"><label class="checkbox"><input type="checkbox" ng-model="selected.available[$index].selected"> {{ renderItem(entity) }}</label></li></ul></div></div>',
link:function(a,d,l){function h(b,c){var k=[];e.forEach(b,function(b){for(var d=!1,e=0;e<c.length;e++)if(a.renderItem(c[e])==a.renderItem(b)){d=!0;break}d||k.push(b)});return k}a.selected={available:[],current:[]};d=function(b){var c=f.defer();a[b]&&0<a[b].length||a[b]&&!a[b].hasOwnProperty("$promise")?c.resolve(a[b]):a.$watch(b,function(a,b){void 0!==a&&void 0===b&&c.resolve(a)});return c.promise};a.refreshAvailable=function(){a.available=h(a.available,a.model);a.selected.available=g(a.available);
a.selected.current=g(a.model)};a.add=function(){a.model=a.model.concat(a.selected(a.selected.available))};a.remove=function(){var b=a.selected(a.selected.current);a.available=a.available.concat(b);a.model=h(a.model,b)};a.selected=function(a){var c=[];e.forEach(a,function(a){!0===a.selected&&c.push(a)});return c};f.all([d("model"),d("available")]).then(function(b){a.refreshAvailable();a.$watch("model",a.refreshAvailable)});a.renderItem=function(b){var c=l.display.match(/(.+)\s+as\s+(.+)/);a[c[1]]=
b;return a.$eval(c[2])}}}}])})(angular);