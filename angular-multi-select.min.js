(function(d){d.module("multi-select",[]).directive("multiSelect",["$q","$parse",function(h,n){function k(a){var b=[];d.forEach(a,function(a){a.selected=!1;b.push(a)});return b}return{restrict:"E",require:"ngModel",scope:{selectedLabel:"@",availableLabel:"@",available:"=",model:"=ngModel"},template:'<div class="multiSelect"><div class="select"><label class="control-label" for="multiSelectSelected">{{ selectedLabel }} ({{ model.length }})</label><ul><li ng-repeat="entity in model"><label class="checkbox" title="{{ renderTitle(entity) }}"><input type="checkbox" ng-model="selected.current[$index].selected"> {{ renderItem(entity) }}</label></li></ul></div><div class="select buttons"><button class="btn mover left" ng-click="add()" title="Add selected" ng-disabled="!selected(selected.available).length"><i class="icon-arrow-left"></i></button><button class="btn mover right" ng-click="remove()" title="Remove selected" ng-disabled="!selected(selected.current).length"><i class="icon-arrow-right"></i></button></div><div class="select"><label class="control-label" for="multiSelectAvailable">{{ availableLabel }} ({{ available.length }})</label><ul><li ng-repeat="entity in available"><label class="checkbox" title="{{ renderTitle(entity) }}"><input type="checkbox" ng-model="selected.available[$index].selected"> {{ renderItem(entity) }}</label></li></ul></div></div>',
link:function(a,b,g){function l(c,f){var e=[];d.forEach(c,function(c){for(var b=!1,d=0;d<f.length;d++)if(a.renderItem(f[d])==a.renderItem(c)){b=!0;break}b||e.push(c)});return e}function m(a,f){var e=f.match(/(.+)\s+as\s+(.+)/),b={};b[e[1]]=a;return n(e[2])(b)}a.selected={available:[],current:[]};b=function(c){var b=h.defer();a[c]&&!a[c].hasOwnProperty("$promise")?b.resolve(a[c]):a.$watch(c,function(a,c){void 0!==a&&void 0===c&&b.resolve(a)});return b.promise};a.refreshAvailable=function(){a.available=
l(a.available,a.model);a.selected.available=k(a.available);a.selected.current=k(a.model)};a.add=function(){a.model=a.model.concat(a.selected(a.selected.available))};a.remove=function(){var c=a.selected(a.selected.current);a.available=a.available.concat(c);a.model=l(a.model,c)};a.selected=function(a){var b=[];d.forEach(a,function(a){!0===a.selected&&b.push(a)});return b};h.all([b("model"),b("available")]).then(function(b){a.refreshAvailable();a.$watch("model",a.refreshAvailable)});a.renderItem=function(a){return m(a,
g.display)};a.renderTitle=function(a){return g.title?m(a,g.title):""}}}}])})(angular);