(function(e){e.module("multi-select",[]).directive("multiSelect",["$q","$compile",function(h,q){function k(a){var d=[];e.forEach(a,function(a){a.selected=!1;d.push(a)});return d}return{restrict:"E",require:"ngModel",scope:{selectedLabel:"@",availableLabel:"@",display:"@",available:"=",model:"=ngModel"},template:'<div class="multiSelect"><div class="select"><label class="control-label" for="multiSelectSelected">{{ selectedLabel }} ({{ model.length }})</label><ul><li ng-repeat="entity in model"><label class="checkbox"><input type="checkbox" ng-model="selected.current[$index].selected"> {{ renderItem(entity) }}</label></li></ul></div><div class="select buttons"><button class="btn mover left" ng-click="add()" title="Add selected" ng-disabled="!selected(selected.available).length"><i class="icon-arrow-left"></i></button><button class="btn mover right" ng-click="remove()" title="Remove selected" ng-disabled="!selected(selected.current).length"><i class="icon-arrow-right"></i></button></div><div class="select"><label class="control-label" for="multiSelectAvailable">{{ availableLabel }} ({{ available.length }})</label><ul><li ng-repeat="entity in available"><label class="checkbox"><input type="checkbox" ng-model="selected.available[$index].selected"> {{ renderItem(entity) }}</label></li></ul></div><input type="number" name="numSelected" ng-model="numSelected" style="display: none"></div>',
link:function(a,d,f,g){function l(b,c){var m=[];e.forEach(b,function(b){for(var d=!1,e=0;e<c.length;e++)if(a.renderItem(c[e])==a.renderItem(b)){d=!0;break}d||m.push(b)});return m}a.selected={available:[],current:[]};g=function(b){var c=h.defer();a[b]&&!a[b].hasOwnProperty("$promise")||a[b]&&0<a[b].length?c.resolve(a[b]):a.$watch(b,function(a,b){a&&0<a.length&&c.resolve(a)});return c.promise};a.refreshAvailable=function(){a.available=l(a.available,a.model);a.selected.available=k(a.available);a.selected.current=
k(a.model)};a.add=function(){a.model=a.model.concat(a.selected(a.selected.available))};a.remove=function(){var b=a.selected(a.selected.current);a.available=a.available.concat(b);a.model=l(a.model,b)};a.selected=function(a){var c=[];e.forEach(a,function(a){!0===a.selected&&c.push(a)});return c};h.all([g("model"),g("available")]).then(function(b){a.refreshAvailable();a.$watch("model",a.refreshAvailable)});a.renderItem=function(b){var c=f.display.match(/(.+)\s+as\s+(.+)/);a[c[1]]=b;return a.$eval(c[2])};
a.$watch("model",function(b){f.requiredMin&&b&&(a.numSelected=b.length,n.$setValidity("min",a.numSelected>=p))});var p,n;f.requiredMin&&(p=parseInt(f.requiredMin,10),d=d.find("input"),n=e.element(d[d.length-1]).controller("ngModel"))}}}])})(angular);